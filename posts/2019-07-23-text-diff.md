# Diffing Collaborative Text

A [common advice](https://github.com/Wookai/paper-tips-and-tricks#one-sentence-per-line) I've read in the past suggests, that we should write text documents (like LaTeX documents or Markdown documentation) in a way, so that each sentence is put on its own line.
This gives us an easier time to create diffs of documents which are created in a collaborative fashion.

Emacs offers a function `fill-paragraph`, which breaks a given line before a specific column width.
This might look like this:

``` plaintext
A [common
advice](https://github.com/Wookai/paper-tips-and-tricks#one-sentence-per-line)
I've read in the past suggests, that we should write text documents (like LaTeX
documents or Markdown documentation) in a way, so that each sentence is put on
its own line. This gives us an easier time to create diffs of documents which
are created in a collaborative fashion.
```

`fill-paragraph` looks decent, but it can create massive diffs which are hard to reason about.
There are several questions on StackOverflow (such as [this one](https://emacs.stackexchange.com/questions/443/editing-files-with-one-sentence-per-line)) where people ask for a customized version of `fill-paragraph` which could format a piece of text, so that each sentence is put onto a new line.
I've recently started to read the Emacs Lisp introduction tutorial (which ships with Emacs itself), so I've tried to come up with my own solution to this problem.
I took some inspiration from the above StackOverflow post.
Here's the code:

``` emacs-lisp
(defun fw/unfill-paragraph ()
  "Unfill the paragraph at point."
  (interactive)
  (let ((fill-column (point-max)))
    (fill-paragraph)))

(defun fw/wrap-at-sentences ()
  "Fills the current paragraph, but starts each sentence on a new line."
  (interactive)
  (save-excursion
    (fw/unfill-paragraph)
    (mark-paragraph)
    (let ((end-of-paragraph (region-end)))
      (while (< (point) end-of-paragraph)
        (forward-sentence)
        ;; We don't want the add a new line at the end of the paragraph
        (if (< (+ (point) 1) end-of-paragraph)
            (newline-and-indent)))))
  ;; The selection will not be cleared if there is only one sentence in a paragraph
  (deactivate-mark))
```

The above code works for the most part, but there are still two edge cases which annoy me:

- Emacs treats phrases such as "e.g." or "i.e." as the end of a sentence, which means that a single sentence might end up on more than one line
- The `markdown-mode` package has ambiguous behavior regarding lists.
  Depending on what operations you perform, a list might be formatted in two different ways.
  This can be visualized using an example:

Here's the initial text on one line:

``` plaintext
- Some example sentence which contains no content. Another pointless example sentence. A third sentence.
```

If we put a new line right after every sentence, the text will end up like this:

``` plaintext
- Some example sentence which contains no content.
Another pointless example sentence.
A third sentence.
```

If we instead indent the second sentence before we put a new line on every following sentence, each following sentence will have the correct indentation:

``` plaintext
- Some example sentence which contains no content.
  Another pointless example sentence.
  A third sentence.
```

Both versions seem to be valid Markdown (well, at least for every interpreter that I've tried), but I'd still prefer the second version.
